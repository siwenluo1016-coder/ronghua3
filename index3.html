<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图层叠加展示 -> 擦除交互</title>
  <style>
    /* 通用样式 */
    body {
      margin: 0;
      padding: 0;
      background-color: #f0e6d2;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      transition: opacity 1s ease;
    }
    
    .container {
      position: relative;
      width: 640px;
      height: 1030px;
      border: 1px solid #ddd;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    /* 初始页面样式 */
    .initial-page {
      display: block;
    }
    
    /* 渐显动画 */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes breathe {
      0% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 0.8; }
    }

    .element {
      position: absolute;
      animation: fadeIn 3s ease forwards;
      opacity: 0;
      object-fit: contain;
    }
    
    .layer1 {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      animation-delay: 0.2s;
      z-index: 1;
    }
    
    .layer2 {
      top: 28%;
      right: 34%;
      width: 12%;
      animation: fadeIn 3s ease forwards, breathe 3s infinite ease-in-out;
      animation-delay: 0.2s;
      z-index: 3;
    }
    
    .layer3 {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      animation-delay: 0.2s;
      z-index: 2;
      opacity: 0.7;
    }
    
    .layer4 {
      bottom: 60%;
      right: 45%;
      width: 12%;
      animation-delay: 0.2s;
      z-index: 3;
    }
    
    .click-area {
      position: absolute;
      top: 28%;
      right: 38%;
      width: 12%;
      height: 12%;
      z-index: 10;
      cursor: pointer;
    }

    /* 擦除页面样式 */
    .wipe-page {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 1s ease;
    }

    .wipe-page.active {
      display: block;
      opacity: 1;
    }

    .wipe-element {
      position: absolute;
      object-fit: contain;
    }

    .wipe-layer1 {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      width: 100%;
      opacity: 1;
      transform-origin:63% 21.5%;
      transition: transform 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .text-layer {
      top: 10%;
      left: 47%;
      transform: translate(-50%, -50%);
      width: 60%;
      z-index: 2;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .wipe-area {
      position: absolute;
      top: 25%;
      right: 20%;
      width: 50%;
      height: 40%;
      z-index: 1000;
      cursor: crosshair;
      display: none;
      touch-action: none;
    }

    .final-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 100;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    /* 视频和封面图样式 */
    .video-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 200;
      opacity: 0;
      transition: opacity 0.5s ease-out;
      background-color: transparent;
    }
    .video-cover {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 201;
      opacity: 0;
      transition: opacity 0.5s ease-in;
    }

    .fade-image {
      position: absolute;
      top: 75%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90%;
      max-height: 80%;
      z-index: 201;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .qicheng {
      position: absolute;
      top: 94%;
      left: 80%;
      transform: translate(-50%, -50%);
      width: 22%;
      z-index: 201;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      cursor: pointer; /* 新增：鼠标悬浮显示手型 */
    }

    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    .pulse-animation {
      animation: pulse 2s infinite ease-in-out;
    }

    /* 音乐图标样式 - 固定在容器右上角 */
    #music-icon {
      position: absolute;
      top: 25px;          /* 距离顶部20px，可调整 */
      right: 25px;        /* 距离右侧20px，可调整 */
      width: 50px;        /* 图标宽度，可调整 */
      height: auto;       /* 高度自适应，保持比例 */
      z-index: 9999;      /* 最高层级，确保不被遮挡 */
      cursor: pointer;    /* 鼠标悬停显示手型 */
      animation: fadeIn 3s ease forwards;
      animation-delay: 0.2s; /* 和其他元素同步显示 */
      opacity: 0;
      transition: transform 0.2s ease; /* 点击时的轻微动画 */
      pointer-events: auto; /* 确保可以点击 */
    }

    /* 音乐图标悬停效果 */
    #music-icon:hover {
      transform: scale(1.05); /* 轻微放大，提升交互体验 */
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 音乐图标 - 初始状态同步上一页 -->
    <img src="music1.png" alt="音乐图标" id="music-icon" class="element">

    <!-- 初始页面 -->
    <div class="initial-page">
      <img src="rh3/点击光圈后.png" class="element layer1" alt="图层1">
      <img src="rh3/光圈.png" class="element layer2" alt="图层2">
      <img src="rh3/透明.png" class="element layer3" alt="图层3">
      <img src="rh3/手指.png" class="element layer4" alt="图层4">
      <div id="smoothTransition" class="click-area"></div>
    </div>

    <!-- 擦除页面 -->
    <div class="wipe-page">
      <img src="rh3/点击光圈后.png" class="wipe-element wipe-layer1" id="backgroundImage" alt="图层1">
      <img src="rh3/字.png" class="wipe-element text-layer" id="textLayer" alt="字">
      <div class="wipe-area" id="wipeArea"></div>
      <img src="rh3/擦除完.jpg" class="final-overlay" id="finalOverlay" alt="擦除完成">
      
      <img src="rh3/擦除完.jpg" class="video-cover" id="videoCover" alt="视频封面">
      <video class="video-background" id="videoBackground" preload="auto" muted>
        <source src="rh3/ca22611b8fac465ddb655ac1782d531e_raw.mp4" type="video/mp4">
      </video>
      
      <img src="rh3/1049912e592100ff409228f85c496fc0.png" class="fade-image" id="fadeImage1" alt="图片一">
      <img src="rh3/ec2a38131b5248be8b60c5381eb73aad.png" class="fade-image" id="fadeImage2" alt="图片二">
      <img src="rh3/df82cceba15824d3ecdf4ed3b8d8f927.png" class="qicheng" id="fadeImage3" alt="图片三">
    </div>
  </div>

  <script>
    // ====================== 音乐功能核心代码 ======================
    // 1. 初始化音频，衔接上一页进度
    const musicIcon = document.getElementById('music-icon');
    let audio = new Audio('music.mp3'); // 保持和上一页相同的音频文件
    audio.loop = true;
    audio.volume = 0.8;
    
    // 读取上一页传递的音频状态
    let audioState = JSON.parse(localStorage.getItem('audioState') || '{"isPlaying":false,"icon":"music1.png","currentTime":0}');
    
    // 页面加载时恢复音频状态
    document.addEventListener('DOMContentLoaded', function() {
      // 恢复播放进度
      if (audioState.currentTime) {
        audio.currentTime = audioState.currentTime;
      }
      
      // 同步音乐图标
      musicIcon.src = audioState.icon;
      
      // 自动续播（处理浏览器自动播放限制）
      if (audioState.isPlaying) {
        setTimeout(() => {
          audio.play().catch(err => {
            console.log('需点击图标恢复播放');
          });
        }, 100);
      }
    });

    // 2. 音乐图标点击切换（一次点击切换）
    musicIcon.addEventListener('click', function(e) {
      e.stopPropagation(); // 阻止触发其他交互
      
      if (audio.paused) {
        // 暂停 → 播放
        audio.play();
        this.src = 'music.png';
        audioState.isPlaying = true;
      } else {
        // 播放 → 暂停
        audio.pause();
        this.src = 'music1.png';
        audioState.isPlaying = false;
      }
      
      // 更新并保存音频状态（供下一页衔接）
      audioState.currentTime = audio.currentTime;
      audioState.icon = this.src;
      localStorage.setItem('audioState', JSON.stringify(audioState));
    });

    // ====================== 原有交互逻辑 ======================
    document.getElementById('smoothTransition').addEventListener('click', function() {
      document.querySelector('.initial-page').style.display = 'none';
      document.querySelector('.wipe-page').classList.add('active');
      initWipePage();
    });

    function initWipePage() {
      const backgroundImage = document.getElementById('backgroundImage');
      const textLayer = document.getElementById('textLayer');
      const wipeArea = document.getElementById('wipeArea');
      const finalOverlay = document.getElementById('finalOverlay');
      const videoBackground = document.getElementById('videoBackground');
      const videoCover = document.getElementById('videoCover');
      const fadeImage1 = document.getElementById('fadeImage1');
      const fadeImage2 = document.getElementById('fadeImage2');
      const fadeImage3 = document.getElementById('fadeImage3');

      // 新增：跳转目标路径（本地文件协议）
      const targetUrl = 'file:///D:/绒花1/flower-4/index4.html';
      // 新增：给fadeImage3添加点击跳转事件
      fadeImage3.addEventListener('click', function() {
        // 跳转前保存最新音频状态
        audioState.currentTime = audio.currentTime;
        audioState.isPlaying = !audio.paused;
        audioState.icon = musicIcon.src;
        localStorage.setItem('audioState', JSON.stringify(audioState));
        
        window.location.href = targetUrl;
      });

      let wipeCount = 0;
      const wipeThreshold = 60;
      let isWiping = false;
      let hasTriggered = false;

      // 恢复擦除前的背景放大和文字显示
      setTimeout(() => {
        backgroundImage.style.transform = 'translate(-50%, -50%) scale(2.75)';
        setTimeout(() => {
          textLayer.style.opacity = '1';
          wipeArea.style.display = 'block'; // 显示擦除区域
        }, 2000);
      }, 100);

      // 恢复完整的擦除逻辑
      wipeArea.addEventListener('mousedown', (e) => {
        if (e.button === 0) {
          isWiping = true;
          wipeCount = 0;
        }
      });
      wipeArea.addEventListener('mousemove', () => {
        if (isWiping && !hasTriggered) {
          wipeCount++;
          if (wipeCount >= wipeThreshold) {
            showFinalOverlay();
            hasTriggered = true;
          }
        }
      });
      wipeArea.addEventListener('touchstart', (e) => {
        e.preventDefault();
        isWiping = true;
        wipeCount = 0;
      }, { passive: false });
      wipeArea.addEventListener('touchmove', (e) => {
        e.preventDefault();
        if (isWiping && !hasTriggered) {
          wipeCount++;
          if (wipeCount >= wipeThreshold) {
            showFinalOverlay();
            hasTriggered = true;
          }
        }
      }, { passive: false });
      function stopWiping() { isWiping = false; }
      wipeArea.addEventListener('mouseup', stopWiping);
      wipeArea.addEventListener('mouseleave', stopWiping);
      wipeArea.addEventListener('touchend', stopWiping);
      wipeArea.addEventListener('touchcancel', stopWiping);

      function showFinalOverlay() {
        setTimeout(() => {
          finalOverlay.style.opacity = '1';
          wipeArea.style.display = 'none';
          setTimeout(() => {
            showVideoAndImages();
          }, 1000);
        }, 300);
      }

      function showVideoAndImages() {
        videoCover.style.opacity = '1';
        videoBackground.load();
        
        const videoLoadedHandler = function() {
          setTimeout(() => {
            videoBackground.style.opacity = '1';
            videoBackground.play();
            setTimeout(() => {
              videoCover.style.opacity = '0';
            }, 300);
            
            setTimeout(() => {
              fadeImage1.style.opacity = '1';
              setTimeout(() => {
                fadeImage2.style.opacity = '1';
                setTimeout(() => {
                  fadeImage3.style.opacity = '1';
                  fadeImage3.classList.add('pulse-animation');
                }, 1500);
              }, 1500);
            }, 500);
            
          }, 500);
        };
        
        videoBackground.addEventListener('loadeddata', videoLoadedHandler, { once: true });
        videoBackground.addEventListener('canplaythrough', videoLoadedHandler, { once: true });
        
        setTimeout(() => {
          if (videoBackground.style.opacity !== '1') {
            videoBackground.style.opacity = '1';
            videoBackground.play();
            videoCover.style.opacity = '0';
            
            setTimeout(() => {
              fadeImage1.style.opacity = '1';
              setTimeout(() => {
                fadeImage2.style.opacity = '1';
                setTimeout(() => {
                  fadeImage3.style.opacity = '1';
                  fadeImage3.classList.add('pulse-animation');
                }, 1500);
              }, 1500);
            }, 500);
          }
        }, 3000);
      }
    }
  </script>
</body>
</html>